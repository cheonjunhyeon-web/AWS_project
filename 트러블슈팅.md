# 1
Lambda2 에서 step functions의 경로로 들어가는 과정에서 오류가 발생했다. <br> 
<img width="1190" height="263" alt="image" src="https://github.com/user-attachments/assets/bb78f846-b9b6-4ca8-890e-912d0a435f09" />
<img width="1166" height="208" alt="image" src="https://github.com/user-attachments/assets/5fa38221-739b-4768-a3b4-9c12acf88ade" />
<br> 위에 body부분에서 is not authorized to perform: states:StartExecution 이라는 문구가 보인다. <br>
이 뜻은 람다는 states:StartExecution(Step Functions를 실행시키는 기능)을 할 수 있는 권한이 없다. 라는 뜻이다. 
<br> 즉 람다에게 step Functions로 들어갈 수 있는 권한을 넣어주면 해결되는 문제이다. <br>
1단계 : 람다의 '역할(Role)'확인
<img width="1590" height="231" alt="image" src="https://github.com/user-attachments/assets/9ddb9f25-0742-40de-bc76-4867b0385204" />
<br> 역할 이름 밑에 있는 링크로 접속한다. 
<img width="1584" height="302" alt="image" src="https://github.com/user-attachments/assets/dc6e98cd-b5d2-4d90-9f9e-738f1f642424" />
권한 정책에서 권한 추가를 눌러서 AWS step functionsFullAccess를 추가시켜준다. 
<img width="1577" height="269" alt="image" src="https://github.com/user-attachments/assets/f0344701-2f60-4c81-a23e-e08f4a0aeb18" />
권한을 추가하고 테스트를 해보니 정상 작동하는 것을 볼 수 있다.<br>
<img width="1189" height="387" alt="image" src="https://github.com/user-attachments/assets/570312e5-c47c-4ca5-84d8-ca5383f3cf18" />
# 2
Step Functions에서 SNS Lambda로 넘어가 실행하는 과정에서 에러 발생 
<img width="1574" height="501" alt="image" src="https://github.com/user-attachments/assets/aa9d6029-ea5d-4bf7-9319-8642cf78fa63" />
아 ..  간단한 문제였음. <br>
<img width="892" height="383" alt="image" src="https://github.com/user-attachments/assets/76851979-72c3-40b9-9e80-af69d40438b8" />
보안 경보 메시지를 보낼때 공격자 IP를 넣어줄려고 했는데 ip를 대문자로 넣어놔서 에러가 떳던것 ip로 변경하니 또 다른 오류가 발생 <br>
<img width="1594" height="513" alt="image" src="https://github.com/user-attachments/assets/95a0a4ba-39ea-43e0-9e45-ef24da0dc57f" />
TopicArn에 sns 경로를 넣어놨는데, 이 경로 자체가 잘 못들어간 것을 확인할 수 있다. 규칙이 맞지않아 정상 작동이 안되는 것. 
<img width="578" height="129" alt="image" src="https://github.com/user-attachments/assets/2a51261b-1513-4829-a3c6-4ac9032e4f2b" />
<br> 경로를 수정 해줬다 
<img width="1589" height="581" alt="image" src="https://github.com/user-attachments/assets/ed393f43-eded-46a9-96c3-ccc412fee886" />
경로를 수정하니 정상적으로 되는 것을 확인 
<img width="1296" height="461" alt="image" src="https://github.com/user-attachments/assets/737ea97e-d30f-4b52-a490-e11b9646205a" />
정상적으로 이메일 수신이 되니 이메일을 최대한 자세하게 보내도록 수정 할 예정이다.

# 3 
Security-Responder lambda에서 IP를 차단하는 로직 발생 중 WAF에 정상적으로 차단되지 않는 상황 <br>
맨 처음 봐야할 것은 Step Functions이다. Step Functions에서는 성장적으로 람다가 실행되어 있다고 한다. <br>
<img width="730" height="550" alt="image" src="https://github.com/user-attachments/assets/be5e6e48-7735-4150-8f67-7ba11f89a2e2" />
<br>
하지만 왜 WAF에 차단이 되지않을까..? 일단 차단을 담당하는 Security-Responder-Lambda로 들어가서 모니터링 목록으로 들어간다. <br>
밑으로 내려가면 CloudWatch Logs 보기라는 버튼이 있다. 여기서 상세한 로그를 확인 가능하다. <br>
<img width="1600" height="467" alt="image" src="https://github.com/user-attachments/assets/f646160f-7812-40e3-90de-a7e21d9070ff" />
차단 실패라는 문구가 하나 있다. 이 문구 뜻은 내가 넣은 WAF ID가 정상적인 ID가 아니라는 뜻이다. <br>
자세하게 찾아보니 내가 보호팩 ID를 넣어었다. 보호팩은 방화벽 전체를 관리한는 역할이고, IP 세트는 IP 명단을 관리하고 차단하는 역할이다. 즉 보호팩 ID가 아닌 IP 세트 주소를 넣어주면 정상적으로 차단될 것이다. 
다시 테스트 해보니 IP 주소가 정상적으로 차단되었다. 
<img width="1892" height="587" alt="image" src="https://github.com/user-attachments/assets/c99d15f8-d9f2-4615-bcce-e591d2152a53" />
